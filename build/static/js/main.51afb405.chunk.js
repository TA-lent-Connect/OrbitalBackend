(this.webpackJsonporbital=this.webpackJsonporbital||[]).push([[0],{41:function(e,t,n){"use strict";n.r(t);var c=n(16),r=n.n(c),s=n(5),i=n.n(s),a=n(6),u=n(3),l=n(1),o=n(4),j=n.n(o),d=n(0),b=function(e){var t=e.module;return Object(d.jsxs)("div",{children:[Object(d.jsx)("p",{children:t.moduleCode}),Object(d.jsx)("p",{children:t.title}),Object(d.jsx)("p",{children:t.description})]})},h=function(e){var t=e.listing;return Object(d.jsx)("div",{children:Object(d.jsx)("li",{className:"listing",children:t.module})})},O=function(e){var t=e.message;return null===t?null:Object(d.jsx)("div",{className:"error",children:t})},f=function(e){var t=e.handleSubmit,n=e.handleUsernameChange,c=e.handlePasswordChange,r=e.username,s=e.password;return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Login"}),Object(d.jsxs)("form",{onSubmit:t,children:[Object(d.jsxs)("div",{children:["username",Object(d.jsx)("input",{value:r,onChange:n})]}),Object(d.jsxs)("div",{children:["password",Object(d.jsx)("input",{type:"password",value:s,onChange:c})]}),Object(d.jsx)("button",{type:"submit",children:"login"})]})]})},x=function(e){var t=e.createListing,n=Object(l.useState)(""),c=Object(u.a)(n,2),r=c[0],s=c[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Create a new Listing"}),Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t({module:r}),s("")},children:[Object(d.jsx)("input",{value:r,onChange:function(e){s(e.target.value)}}),Object(d.jsx)("button",{type:"submit",children:"save"})]})]})},p=function(e){var t=Object(l.useState)(!1),n=Object(u.a)(t,2),c=n[0],r=n[1],s={display:c?"none":""},i={display:c?"":"none"},a=function(){r(!c)};return Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{style:s,children:Object(d.jsx)("button",{onClick:a,children:e.buttonLabel})}),Object(d.jsxs)("div",{style:i,children:[e.children,Object(d.jsx)("button",{onClick:a,children:"cancel"})]})]})},g="/api/listings",v=null,m=function(){return j.a.get(g).then((function(e){return e.data}))},w=function(e){var t={headers:{Authorization:v}};return j.a.post(g,e,t).then((function(e){return e.data}))},S=function(e){v="bearer ".concat(e)},C={login:function(){var e=Object(a.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},y=function(){var e=Object(l.useState)([]),t=Object(u.a)(e,2),n=t[0],c=t[1],r=Object(l.useState)(""),s=Object(u.a)(r,2),o=s[0],g=s[1],v=Object(l.useState)([]),y=Object(u.a)(v,2),k=y[0],L=y[1],E=Object(l.useState)(null),I=Object(u.a)(E,2),J=I[0],N=I[1],U=Object(l.useState)(""),D=Object(u.a)(U,2),M=D[0],P=D[1],z=Object(l.useState)(""),A=Object(u.a)(z,2),B=A[0],T=A[1],W=Object(l.useState)(null),q=Object(u.a)(W,2),F=q[0],G=q[1];Object(l.useEffect)((function(){j.a.get("https://api.nusmods.com/v2/2020-2021/moduleInfo.json").then((function(e){c(e.data)}))}),[]),Object(l.useEffect)((function(){m().then((function(e){L(e)}))}),[]),Object(l.useEffect)((function(){var e=window.localStorage.getItem("loggedUser");if(e){var t=JSON.parse(e);G(t),S(t.token)}}),[]);var H=function(e){w(e).then((function(e){L(k.concat(e))}))},K=n.filter((function(e){return e.moduleCode.includes(o)})),Q=function(e){P(e.target.value)},R=function(e){T(e.target.value)},V=function(){var e=Object(a.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,C.login({username:M,password:B});case 4:n=e.sent,S(n.token),window.localStorage.setItem("loggedUser",JSON.stringify(n)),G(n),P(""),T(""),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),N("Wrong credentials"),setTimeout((function(){N(null)}),5e3);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{children:[Object(d.jsx)(O,{message:J}),null===F?Object(d.jsx)(p,{buttonLabel:"log in",children:Object(d.jsx)(f,{username:M,password:B,handleUsernameChange:Q,handlePasswordChange:R,handleSubmit:V})}):Object(d.jsxs)("div",{children:[Object(d.jsxs)("p",{children:[F.name," logged in"]}),Object(d.jsx)("h1",{children:"My Listings"}),Object(d.jsx)("ul",{children:k.filter((function(e){return e.user.username===F.username})).map((function(e){return Object(d.jsx)(h,{listing:e},e.id)}))}),Object(d.jsx)(p,{buttonLabel:"new listing",children:Object(d.jsx)(x,{createListing:H})})]}),Object(d.jsx)("h1",{children:"Current Listings"}),Object(d.jsx)("ul",{children:k.map((function(e){return Object(d.jsx)(h,{listing:e},e.id)}))}),Object(d.jsx)("h1",{children:"Modules"}),Object(d.jsx)("form",{children:Object(d.jsxs)("label",{children:["find modules:",Object(d.jsx)("input",{value:o,onChange:function(e){g(e.target.value)}})]})}),Object(d.jsx)("div",{children:K.map((function(e){return Object(d.jsx)(b,{module:e},e.moduleCode)}))})]})};r.a.render(Object(d.jsx)(y,{}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.51afb405.chunk.js.map